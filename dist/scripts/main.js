(function(){angular.module("vitalsigns",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(t,e){return t.state("main",{url:"/i/:indicators/c/:communities","abstract":!0,templateUrl:"partials/main.tpl.html",resolve:{indicatorSelection:["$location","$rootScope","$stateParams","Selection",function(t,e,n,r){var i;return i=new r(n.indicators),i.onChange=function(){var n,r;return e.skipStateChange=!0,n=t.path(),r=n.replace(/\/i\/[^\/]*\//,"/i/"+this.toString()+"/"),t.path(r)},i}],communitySelection:["$location","$rootScope","$stateParams","Selection",function(t,e,n,r){var i,o,s;return i=function(t){return t.replace(/-/g,"-~").replace(/\//g,"--").replace(/\s/g,"-_")},s=function(t){return t.replace(/-_/g," ").replace(/--/g,"/").replace(/-~/g,"-")},o=new r(s(n.communities)),o.onChange=function(){var n,r;return e.skipStateChange=!0,n=t.path(),r=n.replace(/\/c\/[^\/]*\//,"/c/"+i(this.toString())+"/"),t.path(r)},o}],dataset:"vsData"}}).state("main.multiples",{url:"/",views:{controls:{templateUrl:"partials/controls.tpl.html",controller:"controls"},multiples:{templateUrl:"partials/multiples.tpl.html",controller:"multiples"},comments:{template:""}}}),e.otherwise("/i//c//"),e.deferIntercept()}]).run(["$rootScope","$urlRouter",function(t,e){return t._=_,t.$on("$locationChangeSuccess",function(e){return t.skipStateChange?(t.skipStateChange=!1,e.preventDefault()):void 0}),e.listen()}]).controller("controls",["$scope","dataset","indicatorSelection",function(t,e,n){var r;return t.varInfo=e.varInfo,t.indicators=_(e.varInfo.values()).filter(function(t){return _.contains(e.variables,t["Variable Name"])}).groupBy("Section").value(),t.clear=function(){return n.clear()},t.isSelected=function(t){return n.isSelected(t["Variable Name"])},t.select=function(t){return n.select(_.isArray(t)?_.pluck(variables,"Variable Name"):t["Variable Name"])},r=null,t.startDragSelect=function(e){return t.select(e),t.isSelected(e)?r=e:void 0},t.endDragSelect=function(){return r=null},t.dragSelect=function(e,i){var o,s,a,c,u;if(null!=r){for(s=1+_(t.indicators[e]).indexOf(r),a=_(t.indicators[e]).indexOf(i),u=[],o=c=s;a>=s?a>=c:c>=a;o=a>=s?++c:--c)u.push(n.add(t.indicators[e][o]["Variable Name"]));return u}}}]).controller("multiples",["$scope","dataset","indicatorSelection","communitySelection",function(t,e,n,r){return t.vitalsigns=e.vitalsigns,t.varInfo=e.varInfo,t.selection=n,t.communitySelection=r,t.selectCommunity=function(e){return t.communitySelection.select(e)},t.showCommunity=function(e,n){return t.currentCommunity=e,t.currentIndicator=n,t.activeCommunities=[e]},t.selectCommunities=function(e){return t.communitySelection.select(e),t.activeCommunities=[]},t.showCommunities=function(e,n){return t.currentCommunity=1===e.length?e[0]:null,t.currentIndicator=n,t.activeCommunities=e},t.moveLeft=function(e){var r,i;return r=_.indexOf(t.selection.selectedValues,e),i=t.selection.selectedValues[r],n.selectedValues[r]=t.selection.selectedValues[r-1],n.selectedValues[r-1]=i,n.onChange()},t.moveRight=function(e){var r,i;return r=_.indexOf(t.selection.selectedValues,e),i=t.selection.selectedValues[r],n.selectedValues[r]=t.selection.selectedValues[r+1],n.selectedValues[r+1]=i,n.onChange()}}])}).call(this),function(){angular.module("vitalsigns").factory("vsData",["$q",function(t){var e,n,r,i;return e=t.defer(),i={topojson:null,codebook:null,vitalsigns:d3.map(),variables:[],varInfo:d3.map()},d3.json("data/csa_2010_boundaries/CSA_NSA_Tracts.topo.json",function(t,n){if(t)throw e.reject(t),new Error(t);return i.topojson=n,d3.csv("data/Vital Signs Codebook and Sources - Variables and Sources.csv",function(t){return t},function(t,n){var r,o,s,a,c,u,l,h,d,p,f,v;if(t)throw e.reject(t),new Error(t);for(i.codebook=n,v=i.codebook,h=0,p=v.length;p>h;h++)for(s=v[h],a=s["Variable Name"],a=a.substring(0,a.length-2),l=function(){var t,e;for(e=[],c=t=2007;2013>=t;c=++t)e.push(c);return e}(),o=function(t,e){return(1e15+t+"").slice(-e)},d=0,f=l.length;f>d;d++)c=l[d],u=o(c-2e3,2),r=angular.extend({Year:c},s),r["Variable Name"]=a+u,i.varInfo.set(a+u,r);return e.resolve(i)})}),r=function(t){var e,n,r;if(e=t.CSA2010,"Baltimore City"!==e){i.vitalsigns.has(e)||i.vitalsigns.set(e,d3.map());for(n in t)r=t[n],"CSA2010"!==n&&i.vitalsigns.get(e).set(n,r);return t}},n=function(t,e){var n,r,o,s;if(t)throw new Error(t);o=e[0],s=[];for(n in o)r=o[n],s.push("CSA2010"!==n?i.variables.push(n):void 0);return s},d3.csv("data/VS Arts 2011-2012 - VS Arts 2010-2012.csv",r,n),d3.csv("data/VS Census 2010-2012 - VS Census 2010-2012.csv",r,n),d3.csv("data/VS Crime 2010-2012 - VS Crime 2010-2012.csv",r,n),d3.csv("data/VS Education 2010-2012 - VS Education 2010-2012.csv",r,n),d3.csv("data/VS Health 2010-2012 - VS_Health_2010-2012.csv",r,n),d3.csv("data/VS Housing 2010-2012 - VS Housing 2010-2012.csv",r,n),d3.csv("data/VS Sustainability 2010-2012 - VS Sustainability 2010-2012.csv",r,n),d3.csv("data/VS Workforce 2010-2012 - VS Workforce 2010-2012.csv",r,n),e.promise}])}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};angular.module("vitalsigns").factory("Selection",function(){var e;return e=function(){function e(e,n){this.clear=t(this.clear,this),this.select=t(this.select,this),this.isSelected=t(this.isSelected,this),this.toggle=t(this.toggle,this),this.remove=t(this.remove,this),this.add=t(this.add,this),this.toString=t(this.toString,this),this.parse=t(this.parse,this),this.selectedValues=[],this.parse(e,n)}return e.prototype.parse=function(t,e){return(null!=t&&"function"==typeof t.trim?t.trim().length:void 0)>0?this.selectedValues=t.split(null!=e?e:":"):void 0},e.prototype.toString=function(t){var e;return(null!=(e=this.selectedValues)?e:[]).join(null!=t?t:":")},e.prototype.add=function(t){return this.isSelected(t)?void 0:(this.selectedValues.push(t),this.onChange())},e.prototype.remove=function(t){var e;return e=_.indexOf(this.selectedValues,t),e>=0?(this.selectedValues.splice(e,1),this.onChange()):void 0},e.prototype.toggle=function(t){return this.isSelected(t)?this.remove(t):this.add(t)},e.prototype.isSelected=function(t){return _.contains(this.selectedValues,t)},e.prototype.select=function(t){var e,n;return _.isArray(t)?(n=this.onChange,e=!1,this.onChange=function(){return e=!0},_.some(t,function(t){return function(e){return!t.isSelected(e)}}(this))?_.map(t,this.add):_.map(t,this.remove),this.onChange=n,e?this.onChange():void 0):this.toggle(t)},e.prototype.clear=function(){return this.selectedValues=[],this.onChange()},e.prototype.onChange=function(){},e}()})}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};angular.module("vitalsigns").factory("parseValue",function(){return function(t){return t=(null!=t?t:"").replace(/[$,]/,""),parseFloat(t)}}).factory("Choropleth",["parseValue",function(e){var n;return n=function(){function n(e,n,r){this.feature=n,this.regionProperty=r,this.redraw=t(this.redraw,this),this.data=t(this.data,this),this.colorRange=t(this.colorRange,this),this.domain=t(this.domain,this),this.value=t(this.value,this),this.click=t(this.click,this),this.hover=t(this.hover,this),this.svg=d3.select(e),this.projection=d3.geo.mercator().scale(5e4).center([-76.6167,39.2833]).translate([this.width/2,this.height/2]),this.path=d3.geo.path().projection(this.projection)}return n.prototype.width=200,n.prototype.height=200,n.prototype._mouseover=function(){},n.prototype._mouseout=function(){},n.prototype.hover=function(t){return null!=t?(this._mouseover=t[0],this._mouseout=t[1],this):[this._mouseover,this._mouseout]},n.prototype._click=function(){},n.prototype.click=function(t){return null!=t?this._click=t:this._click},n.prototype.value=function(t){var n;return e(null!=(n=this.regionData.get(t.id))?n.get(this.regionProperty):void 0)},n.prototype.domain=function(){var t,n;return n=_(this.regionData.values()).map(function(t){return function(n){return e(n.get(t.regionProperty))}}(this)).filter(function(t){return!isNaN(t)}).value(),t=d3.extent(n)},n.prototype.colorRange=function(){return d3.range(9).map(function(t){return"q"+t+"-9"})},n.prototype.data=function(t,e){return this.topojsonData=t,this.regionData=e,this.redraw()},n.prototype.redraw=function(){var t,e;return t=this.topojsonData.objects[this.feature],e=d3.scale.quantize().domain(this.domain()).range(this.colorRange()),this.svg.attr("width",this.width).attr("height",this.height),this.svg.selectAll(".region").data(topojson.feature(this.topojsonData,t).features).enter().append("path").attr("d",this.path).attr("data-region",function(t){return t.id}).attr("class",function(t){return function(n){var r;return r=e(t.value(n)),"region "+r}}(this)).on("mouseover",function(t){return function(e,n){return t._mouseover(e,n)}}(this)).on("mouseout",function(t){return function(e,n){return t._mouseout(e,n)}}(this)).on("click",function(t){return function(e,n){return t._click(e,n)}}(this)),this.svg.append("path").datum(topojson.mesh(this.topojsonData,t)).attr("d",this.path).attr("class","region-boundary")},n}()}]).factory("Histogram",["parseValue",function(e){var n;return n=function(){function n(e,n){this.regionProperty=n,this.redraw=t(this.redraw,this),this.data=t(this.data,this),this.colorRange=t(this.colorRange,this),this.domain=t(this.domain,this),this.value=t(this.value,this),this.click=t(this.click,this),this.hover=t(this.hover,this),this.svg=d3.select(e)}return n.prototype.width=200,n.prototype.height=100,n.prototype._mouseover=function(){},n.prototype._mouseout=function(){},n.prototype.hover=function(t){return null!=t?(this._mouseover=t[0],this._mouseout=t[1],this):[this._mouseover,this._mouseout]},n.prototype._click=function(){},n.prototype.click=function(t){return null!=t?this._click=t:this._click},n.prototype.value=function(t){return e(this.regionData.get(t).get(this.regionProperty))},n.prototype.domain=function(){return d3.extent(this.regionData.keys(),this.value)},n.prototype.colorRange=function(){return d3.range(9).map(function(t){return"q"+t+"-9"})},n.prototype.data=function(t){return this.regionData=t,this.redraw()},n.prototype.redraw=function(){var t,e,n,r,i,o,s,a,c,u,l,h;return o={top:5,right:10,bottom:25,left:10},c=this.width-o.left-o.right,r=this.height-o.top-o.bottom,s=d3.scale.quantize().domain(this.domain()).range(this.colorRange()),u=d3.scale.linear().domain(this.domain()).range([0,c]),i=d3.layout.histogram().bins(u.ticks(10)).value(this.value),e=i(this.regionData.keys()),h=d3.scale.linear().domain([0,d3.max(e,function(){return function(t){return t.y}}(this))]).range([r,0]),l=d3.svg.axis().scale(u).ticks(5).orient("bottom"),n=this.svg.attr("width",this.width).attr("height",this.height).append("g").attr("transform","translate("+o.left+","+o.top+")"),t=n.selectAll(".bar").data(e).enter().append("g").attr("class","bar").attr("transform",function(){return function(t){return"translate("+u(t.x)+","+h(t.y)+")"}}(this)),a=t.append("rect").attr("x",1).attr("width",u(e[0].dx)-u(0)).attr("height",function(){return function(t){return r-h(t.y)}}(this)).attr("class",function(){return function(t){return s(t.x)}}(this)).on("mouseover",function(t){return function(e,n){return t._mouseover(e,n)}}(this)).on("mouseout",function(t){return function(e,n){return t._mouseout(e,n)}}(this)).on("click",function(t){return function(e,n){return t._click(e,n)}}(this)),n.append("g").attr("class","axis").attr("transform","translate(0,"+r+")").call(l)},n}()}]).directive("vsMap",["vsData","Choropleth",function(t,e){return{template:"<div><svg></svg></div>",restrict:"E",replace:!0,scope:{hover:"=",click:"=",selected:"=",active:"="},link:function(n,r,i){return i.$observe("property",function(i){var o,s;return o=r.children("svg")[0],s=new e(o,"CSA_NSA_Tracts",i),t.then(function(t){return n.varInfo=t.varInfo.get(i),s.data(t.topojson,t.vitalsigns),s.hover([function(t){return n.$apply(function(){return n.hover(t.id,i)})},function(){}]),s.click(function(t){return n.$apply(function(){return n.click(t.id)})}),n.$watch("active",function(t){return null!=t?d3.select(o).selectAll(".region").classed("active",function(t){return _.contains(n.active,t.id)}):void 0},!0),n.$watch("selected",function(t){return null!=t?d3.select(o).selectAll(".region").classed("selected",function(t){return _.contains(n.selected,t.id)}):void 0},!0)})})}}}]).directive("vsHistogram",["vsData","Histogram",function(t,e){return{template:"<div><svg></svg></div>",restrict:"E",replace:!0,scope:{hover:"=",click:"=",selected:"=",active:"="},link:function(n,r,i){return i.$observe("property",function(i){var o,s;return s=r.children("svg")[0],o=new e(s,i),t.then(function(t){return n.varInfo=t.varInfo.get(i),o.data(t.vitalsigns),o.hover([function(t){return n.$apply(function(){return n.hover(t,i)})},function(){}]),o.click(function(t){return n.$apply(function(){return n.click(t)})}),n.$watch("active",function(t){return null!=t?d3.select(s).selectAll("rect").classed("active",function(e){return t.length>0&&_(t).every(function(t){return _(e).contains(t)})}):void 0},!0),n.$watch("selected",function(t){return null!=t?d3.select(s).selectAll("rect").classed("selected",function(e){return _(e).every(function(e){return _(t).contains(e)})}):void 0},!0)})})}}}])}.call(this);